<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenRouteService Map Example</title>
    <script src="https://cdn.jsdelivr.net/npm/@sakitam-gis/ol6@6.3.3/dist/ol.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.3.0/ol.css">
    <script src="https://kit.fontawesome.com/0eb73cfc5c.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!--Debounce-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/openrouteservice-js@0.2.0/dist/ors-js-client.min.js"></script>
    <script type="module" src="http://localhost:8084/webgis/openrouteservice-js-main/dist/ors-js-client.js"></script>

    <!--Mapbox-->
    <!-- Load Mapbox GL JS library -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />

    <!-- Load Mapbox GL Directions plugin -->
    <script
        src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js'></script>
    <link rel='stylesheet'
        href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css'
        type='text/css' />

    <style>
        #map {
            width: 100%;
            height: 100vh;
        }

        .routing-floating-widget {
            position: absolute;
            top: 40px;
            left: 40px;
            background-color: white;
            padding: 15px 30px 15px 15px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 410px;
        }

        .mode-buttons {
            display: flex;
            gap: 5px;
        }

        .mode-button {
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            background-color: white;
            color: #1E3050;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            outline: none;
        }

        .mode-button:hover,
        .mode-button.active {
            background-color: #1E3050;
            color: white;
        }

        .input-container {
            display: flex;
            align-items: center;
            border: 2px solid #ddd;
            border-radius: 5px;
            background-color: white;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            height: 40px;
            width: 420px;
            margin-bottom: 5px;
        }

        .input-container:focus-within {
            border-color: #1E3050;
            box-shadow: 0px 2px 4px rgba(0, 123, 255, 0.4);
        }

        .input-container input {
            border: none;
            background-color: transparent;
            flex: 1;
            height: 100%;
            font-size: 16px;
            padding: 0 20px;
        }

        .input-container input::placeholder {
            color: #999;
        }

        .input-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: #1E3050;
        }

        .input-container button {
            border: none;
            background-color: transparent;
            font-size: 20px;
            color: #1E3050;
            cursor: pointer;
            outline: none;
            margin-right: 10px;
        }

        input:focus {
            outline: none;
        }

        #origin,
        #destination {
            flex: 1;
        }

        #gps {
            flex: none;
            width: 30px;
            height: 30px;
            padding: 0;
            border: none;
            background: transparent;
            font-size: 18px;
            color: #cfcfcf;
            cursor: pointer;
            outline: none;
            margin-right: 8px;
        }

        #gps:hover {
            color: #1E3050;
        }

        #gps.active {
            color: #1E3050;
        }

        .use-current-location {
            font-style: italic;
        }

        #routeButton {
            background-color: #1E3050;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.2s;
        }

        #routeButton:hover {
            background-color: #3bb2d4;
        }

        #clearrouteButton {
            display: none;
            /* hide the clear route button initially */
            background-color: #ff0040;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.2s;
        }

        #clearrouteButton:hover {
            background-color: #a20000;
        }


        label[for="mode"] {
            font-family: "Segoe UI", Arial, sans-serif;
            color: gray;
        }

        .input-boxes {
            position: relative;
            margin-top: 20px;
        }

        .suggestions-dropdown {
            position: absolute;
            z-index: 999;
            background-color: white;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            /*width: calc(100% - 2 * 20px - 2 * 2px);*/
            width: 400px;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .input-container {
            position: relative;
        }

        #origin-dropdown {
            top: 50px;
            left: 0;
        }

        #destination-dropdown {
            top: 105px;
            left: 0;
        }

        .dismiss-widget {
            position: absolute;
            top: 8px;
            right: 3px;
            left: auto;
            background-color: transparent;
            border: none;
            font-size: 18px;
            color: #1E3050;
            cursor: pointer;
            outline: none;
        }

        .dismiss-widget:hover {
            color: #666;
        }

        #instructions {
            font-family: 'Segoe UI';
            padding: 20px;
            background-color: white;
            overflow-y: auto;
            max-height: 550px;
        }

        #instructions::-webkit-scrollbar {
            width: 8px;
        }

        #instructions::-webkit-scrollbar-track {
            background-color: #F0F0F0;
            border-radius: 4px;
        }

        #instructions::-webkit-scrollbar-thumb {
            background-color: #C0C0C0;
            border-radius: 4px;
        }

        #instructions::-webkit-scrollbar-thumb:hover {
            background-color: #A0A0A0;
        }

        @-moz-document url-prefix() {
            #instructions {
                scrollbar-width: thin;
                scrollbar-color: #C0C0C0 #F0F0F0;
            }
        }

        #instructions .instruction-step {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            padding: 5px;
        }

        #instructions .instruction-arrow {
            margin-right: 20px;
        }
    </style>
</head>

<body>
    <div id="map"></div>


    <div class="routing-floating-widget">
        <button class="dismiss-widget">
            <i class="fa-solid fa-circle-xmark"></i>
        </button>
        <div class="input-boxes">
            <div class="input-container"> <!--Input Container for Origin-->
                <i class="fa-solid fa-a" style="font-size: 16px; margin-left: 12px; margin-right: 0px;"></i>
                <input type="text" id="origin" placeholder="Origin: Search for a place or click on the map"
                    style="font-size: 14px;">
                <button id="gps" title="Use current location"><i
                        class="fa-sharp fa-solid fa-location-crosshairs"></i></button>
                <button id="clearOrigin" style="display: none;"><i class="fas fa-times"></i></button>
            </div>

            <div class="input-container"> <!--Input Container for Destination-->
                <i class="fa-solid fa-b" style="font-size: 16px; margin-left: 12px; margin-right: 0px;"></i>
                <input type="text" id="destination" placeholder="Destination: Search for a place or click on the map"
                    style="font-size: 14px;">
                <button id="clearDestination" style="display: none;"><i class="fas fa-times"></i></button>
            </div>

            <div id="origin-dropdown" class="suggestions-dropdown"></div>
            <div id="destination-dropdown" class="suggestions-dropdown"></div>
        </div>

        <label for="mode">Select Mode:</label>
        <div class="mode-buttons">
            <button class="mode-button active" data-mode="driving"><i
                    class="fa-sharp fa-solid fa-car"></i>&nbsp;&nbsp;Driving</button>
            <button class="mode-button" data-mode="cycling"><i class="fas fa-bicycle"></i>&nbsp;&nbsp;Cycling</button>
            <button class="mode-button" data-mode="walking"><i class="fas fa-walking"></i>&nbsp;&nbsp;Walking</button>
        </div>
        <button id="routeButton"><i class="fa-sharp fa-solid fa-diamond-turn-right"></i>&nbsp;&nbsp;Route</button>
        <button id="clearrouteButton"><i class="fa-solid fa-trash-can"></i>&nbsp;&nbsp;Clear</button>

        <div style="display: flex; justify-content: space-between;">
            <div id="distance" style="font-family: 'Segoe UI'; margin-left: 30px; display: none;">
                <i class="fa-solid fa-route"></i>
                &nbsp;&nbsp;Distance: N/A
            </div>

            <div id="duration" style="font-family: 'Segoe UI'; margin-right: 30px; display: none;">
                <i class="fas fa-clock"></i>
                &nbsp;&nbsp;Duration: N/A
            </div>
        </div>

        <div id="instructions" style="display: none;"></div>


    </div>

    <div id="origin-dropdown" class="suggestions-dropdown"></div>
    <div id="destination-dropdown" class="suggestions-dropdown"></div>

    <script>
        // Declare originMarker, destinationMarker, and userLocLayer as global variables
        let originMarker, destinationMarker, userLocLayer;


        // Initialize the map
        const map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([105.84117, 21.02851]), // Hanoi, Vietnam
                zoom: 14
            })
        });

        // Check if Geolocation API is supported by the browser
        function isGeolocationSupported() {
            return 'geolocation' in navigator;
        }

        // Locate user function
        function locateUser() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;

                        // Transform coordinates from EPSG:4326 to EPSG:3857
                        const coordinates = ol.proj.transform([longitude, latitude], 'EPSG:4326', 'EPSG:3857');

                        console.log('Current location coordinates:', coordinates);

                        const view = map.getView();
                        view.setCenter(coordinates);
                        view.setZoom(17);

                        // Create new feature with current location coordinates and set it as the geometry of the user location marker
                        const userLoc = new ol.Feature({
                            geometry: new ol.geom.Point(coordinates)
                        });


                        // Reverse geocode using OSM Nominatim
                        const nominatimUrl = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`;
                        $.getJSON(nominatimUrl, (data) => {
                            if (data.address) {
                                const originInput = document.getElementById("origin");
                                originInput.value = data.display_name;

                                // Create new feature with GPS coordinates and set it as the geometry of the origin marker
                                const newOrigin = new ol.Feature({
                                    geometry: new ol.geom.Point(coordinates)
                                });
                                if (!originMarker) {
                                    originMarker = new ol.layer.Vector({
                                        name: 'Origin Marker',
                                        source: new ol.source.Vector({
                                            features: [newOrigin]
                                        }),
                                        style: new ol.style.Style({
                                            image: new ol.style.Icon({
                                                src: 'https://cdn-icons-png.flaticon.com/24/6819/6819077.png',
                                            })
                                        })
                                    });
                                    map.addLayer(originMarker);
                                    console.log('Origin marker:', originMarker);
                                } else {
                                    originMarker.getSource().clear();
                                    originMarker.getSource().addFeature(newOrigin);
                                }
                            }
                        });
                    },
                    () => {
                        alert('Unable to locate your position');
                    }
                );
            } else {
                alert('Geolocation is not supported by this browser');
            }
        }

        function initGpsButton() {
            const gpsButton = document.getElementById('gps');
            gpsButton.addEventListener('click', _.debounce(function () {
                // change color of GPS button
                gpsButton.style.color = "#1E3050";
                locateUser();
            }, 1000, { leading: true, trailing: false }));
        }

        function fetchSuggestions(input, dropdown) {
            const query = input.value.trim();
            if (query.length < 3) {
                dropdown.innerHTML = '';
                dropdown.style.display = 'none';
                return;
            }

            const nominatimUrl = `https://nominatim.openstreetmap.org/search?format=jsonv2&countrycodes=vn&q=${encodeURIComponent(
                query
            )}`;

            $.getJSON(nominatimUrl, (data) => {
                if (data.length > 0) {
                    const items = data
                        .map(
                            (item) =>
                                `<li style="padding: 5px 10px; cursor: pointer;" data-lat="${item.lat}" data-lon="${item.lon}">${item.display_name}</li>`
                        )
                        .join('');
                    dropdown.innerHTML = `<ul style="margin: 0; padding: 0; list-style: none;">${items}</ul>`;
                    dropdown.style.display = 'block';

                    dropdown.querySelectorAll('li').forEach((item) => {
                        item.addEventListener('click', () => {
                            // Extract latitude and longitude from data attributes
                            const lat = parseFloat(item.getAttribute('data-lat'));
                            const lon = parseFloat(item.getAttribute('data-lon'));

                            // Log the coordinates
                            console.log(`Latitude: ${lat}, Longitude: ${lon}`);

                            // Zoom to location and place marker
                            const coordinates = ol.proj.fromLonLat([lon, lat]);
                            const view = map.getView();
                            view.setCenter(coordinates);
                            view.setZoom(17);

                            // Update input field value
                            input.value = item.textContent;
                            dropdown.style.display = 'none';
                        });
                    });
                }
            });
        }

        // Initialize the application
        $(document).ready(function () {
            initGpsButton();
            const originInput = document.getElementById('origin');
            const originDropdown = document.getElementById('origin-dropdown');
            const destinationInput = document.getElementById('destination');
            const destinationDropdown = document.getElementById('destination-dropdown');
            const routeButton = document.getElementById('route');

            originInput.addEventListener('keyup', () => {
                fetchSuggestions(originInput, originDropdown);
            });

            destinationInput.addEventListener('keyup', () => {
                fetchSuggestions(destinationInput, destinationDropdown);
            });
        });

        // Add event listener to map for single click event to set the origin
        map.on('singleclick', function (evt) {
            // Get clicked coordinates in EPSG:3857 format
            const clickedCoord = evt.coordinate;

            // Get the coordinates of the clicked location and transform them to EPSG:4326 format
            const clickedCoord4326 = ol.proj.transform(clickedCoord, 'EPSG:3857', 'EPSG:4326');

            // Log the origin or destination coordinate and latitude coordinate
            console.log('Clicked coordinate:', clickedCoord4326);
            console.log('Longitude coordinate:', clickedCoord4326[0]);
            console.log('Latitude coordinate:', clickedCoord4326[1]);

            // Fetch address from OSM Nominatim using clicked coordinates in EPSG:4326 format
            const nominatimUrl = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${clickedCoord4326[1]}&lon=${clickedCoord4326[0]}`;
            $.getJSON(nominatimUrl, (data) => {
                if (data.address) {
                    const originInput = document.getElementById('origin');
                    const destinationInput = document.getElementById('destination');
                    if (originInput.value.trim() === '') {
                        // Set origin input field value to clicked address
                        originInput.value = data.display_name;

                        // Create new feature with clicked coordinates and set it as the geometry of the origin marker
                        const newOrigin = new ol.Feature({
                            geometry: new ol.geom.Point(clickedCoord)
                        });
                        if (!originMarker) {
                            originMarker = new ol.layer.Vector({
                                name: 'Origin Marker',
                                source: new ol.source.Vector({
                                    features: [newOrigin]
                                }),
                                style: new ol.style.Style({
                                    image: new ol.style.Icon({
                                        src: 'https://cdn-icons-png.flaticon.com/24/6819/6819077.png',
                                    })
                                })
                            });
                            map.addLayer(originMarker);
                            console.log('Origin marker:', originMarker);
                        } else {
                            originMarker.getSource().clear();
                            originMarker.getSource().addFeature(newOrigin);
                        }
                    } else if (destinationInput.value.trim() === '') {
                        // Set destination input field value to clicked address
                        destinationInput.value = data.display_name;

                        // Create new feature with clicked coordinates and set it as the geometry of the destination marker
                        const newDestination = new ol.Feature({
                            geometry: new ol.geom.Point(clickedCoord)
                        });
                        if (!destinationMarker) {
                            destinationMarker = new ol.layer.Vector({
                                name: 'Destination Marker',
                                source: new ol.source.Vector({
                                    features: [newDestination]
                                }),
                                style: new ol.style.Style({
                                    image: new ol.style.Icon({
                                        src: 'https://cdn-icons-png.flaticon.com/24/8142/8142678.png',

                                    })
                                })
                            });
                            map.addLayer(destinationMarker);
                            console.log('Destination marker:', destinationMarker);
                        } else {
                            destinationMarker.getSource().clear();
                            destinationMarker.getSource().addFeature(newDestination);
                        }
                    }

                }
            });
        });

        //let userLocLayer = null;
        let routeLayer = null;

        const originMarkerStyle = new ol.style.Style({
            image: new ol.style.Icon({
                anchor: [0.5, 1],
                src: 'https://cdn-icons-png.flaticon.com/24/6819/6819077.png'
            })
        });

        const destinationMarkerStyle = new ol.style.Style({
            image: new ol.style.Icon({
                anchor: [0.5, 1],
                src: 'https://cdn-icons-png.flaticon.com/24/8142/8142678.png'
            })
        });

        const originList = document.getElementById('origin-dropdown');
        const destinationList = document.getElementById('destination-dropdown');
        const routeButton = document.getElementById('routeButton');
        //let originMarker, destinationMarker;

        originList.addEventListener('click', (event) => {
            const coordinates = [parseFloat(event.target.dataset.lon), parseFloat(event.target.dataset.lat)];
            addMarker(coordinates, 'origin');
        });

        destinationList.addEventListener('click', (event) => {
            const coordinates = [parseFloat(event.target.dataset.lon), parseFloat(event.target.dataset.lat)];
            addMarker(coordinates, 'destination');
        });

        function addMarker(coordinates, type) {
            const marker = new ol.Feature({
                type: type,
                geometry: new ol.geom.Point(ol.proj.fromLonLat(coordinates))
            });

            if (type === 'origin') {
                if (originMarker) {
                    originMarker.getSource().clear();
                }
                originMarker = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: [marker]
                    }),
                    style: originMarkerStyle
                });
                map.addLayer(originMarker);
            } else if (type === 'destination') {
                if (destinationMarker) {
                    destinationMarker.getSource().clear();
                }
                destinationMarker = new ol.layer.Vector({
                    source: new ol.source.Vector({
                        features: [marker]
                    }),
                    style: destinationMarkerStyle
                });
                map.addLayer(destinationMarker);
            }
        }

        let currentMode = 'driving';

        document.addEventListener('DOMContentLoaded', () => {
            const routeButton = document.getElementById('routeButton');
            const modeButtons = document.querySelectorAll('.mode-button');

            modeButtons.forEach((button) => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and add it to the clicked button
                    modeButtons.forEach((btn) => btn.classList.remove('active'));
                    button.classList.add('active');
                    currentMode = button.getAttribute('data-mode');
                });
            });

            routeButton.addEventListener('click', getRoute);
        });

        //Generate Route
        function getRoute() {
            if (!originMarker || !destinationMarker) {
                alert('Please select both an origin and a destination');
                return;
            }

            const originCoord = ol.proj.toLonLat(originMarker.getSource().getFeatures()[0].getGeometry().getCoordinates());
            const destCoord = ol.proj.toLonLat(destinationMarker.getSource().getFeatures()[0].getGeometry().getCoordinates());
            const baseUrl = `https://router.project-osrm.org/route/v1/${currentMode}/${originCoord[0]},${originCoord[1]};${destCoord[0]},${destCoord[1]}?overview=full&geometries=geojson&steps=true`;

            fetch(baseUrl)
                .then((response) => {
                    return response.json();
                })
                .then((data) => {
                    const route = data.routes[0].geometry;
                    const routeCoords = route.coordinates.map((coord) => {
                        return ol.proj.fromLonLat(coord);
                    });
                    const routeFeature = new ol.Feature({
                        type: 'route',
                        geometry: new ol.geom.LineString(routeCoords)
                    });
                    routeFeature.setStyle(
                        new ol.style.Style({
                            stroke: new ol.style.Stroke({
                                width: 6,
                                color: 'rgba(30, 144, 255, 0.8)',
                                shadowColor: 'rgba(30, 144, 255, 0.4)',
                                shadowBlur: 10
                            })
                        })
                    );

                    // Remove the existing route layer, if any
                    if (routeLayer) {
                        map.removeLayer(routeLayer);
                    }

                    routeLayer = new ol.layer.Vector({
                        source: new ol.source.Vector({
                            features: [routeFeature]
                        })
                    });
                    map.addLayer(routeLayer);

                    //Distance and Duration calculation
                    const distance = data.routes[0].distance / 1000;
                    const originalDuration = data.routes[0].duration / 60;
                    const adjustedDuration = originalDuration >= 16 ? originalDuration + 16 : originalDuration;
                    const hours = Math.floor(adjustedDuration / 60);
                    const minutes = Math.ceil(adjustedDuration % 60);

                    document.getElementById('distance').innerHTML = `<i class="fa-solid fa-route"></i>&nbsp;&nbsp;Distance: ${distance.toFixed(2)} km`;

                    if (adjustedDuration >= 60) {
                        document.getElementById('duration').innerHTML = `<i class="fas fa-clock"></i>&nbsp;&nbsp;Duration: ${hours} hr ${minutes} mins`;
                    } else {
                        document.getElementById('duration').innerHTML = `<i class="fas fa-clock"></i>&nbsp;&nbsp;Duration: ${Math.ceil(adjustedDuration)} mins`;
                    }

                    const instructions = generateNavigationInstructions(data.routes[0].legs[0].steps);
                    document.getElementById('instructions').innerHTML = instructions;

                    // Zoom to the extent of the route
                    const extent = routeLayer.getSource().getExtent();
                    map.getView().fit(extent, {
                        padding: [50, 50, 50, 50],
                        maxZoom: 14,
                    });
                })
                .catch((error) => {
                    console.log(error);
                });
        }

        //Route instructions
        function generateNavigationInstructions(steps) {
            let instructions = '';
            steps.forEach((step, index) => {
                const direction = step.maneuver.modifier ? `${step.maneuver.type} ${step.maneuver.modifier}` : step.maneuver.type;
                const distance = step.distance < 1000 ? `${step.distance.toFixed(0)}<span style="font-size: 0.8em;">m</span>` : `${(step.distance / 1000).toFixed(2)}<span style="font-size: 0.8em;">km</span>`;
                const duration = (step.duration / 60).toFixed(2);
                let roadName = '';
                if (step.name) {
                    if (step.name !== 'new name' && !step.name.toLowerCase().includes('unnamed')) {
                        roadName = step.name;
                    }
                }
                if (direction.toLowerCase().includes('new name')) {
                    roadName = '';
                }
                let iconClass = '';
                switch (step.maneuver.type) {
                    case 'depart':
                        iconClass = 'fas fa-flag-checkered';
                        break;
                    case 'arrive':
                        iconClass = 'fas fa-flag-checkered';
                        break;
                    case 'merge':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                step.maneuver.modifier === 'straight' ? 'fas fa-arrow-up' :
                                                    'fas fa-random';
                        break;
                    case 'roundabout':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                step.maneuver.modifier === 'straight' ? 'fas fa-arrow-up' :
                                                    'fas fa-random';
                        break;
                    case 'exit roundabout':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                step.maneuver.modifier === 'straight' ? 'fas fa-arrow-up' :
                                                    'fas fa-random';
                        break;
                    case 'roundabout turn':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                step.maneuver.modifier === 'straight' ? 'fas fa-arrow-up' :
                                                    'fas fa-random';
                        break;
                    case 'turn':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                step.maneuver.modifier === 'straight' ? 'fas fa-arrow-up' :
                                                    'fas fa-random';
                        break;
                    case 'go':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                step.maneuver.modifier === 'straight' ? 'fas fa-arrow-up' :
                                                    'fas fa-random';
                        break;
                    case 'depart ramp':
                    case 'arrive ramp':
                        iconClass = 'fas fa-level-up-alt';
                        break;
                    case 'continue':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                step.maneuver.modifier === 'straight' ? 'fas fa-arrow-up' :
                                                    step.maneuver.modifier === 'uturn' ? 'fas fa-sign-in fa-rotate-270' :
                                                        '';
                        break;
                    case 'on ramp':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                step.maneuver.modifier === 'straight' ? 'fas fa-arrow-up' :
                                                    '';
                        break;

                    case 'off ramp':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                'fas fa-random';
                        break;
                    case 'fork':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                'fas fa-random';
                        break;
                    case 'end of road':
                        iconClass = step.maneuver.modifier === 'left' ? 'fas fa-level-up fa-rotate-270' :
                            step.maneuver.modifier === 'right' ? 'fas fa-level-down fa-rotate-270' :
                                step.maneuver.modifier === 'sharp left' ? 'fa-solid fa-arrow-left-long' :
                                    step.maneuver.modifier === 'sharp right' ? 'fa-solid fa-arrow-right-long' :
                                        step.maneuver.modifier === 'slight left' ? 'fas fa-level-up fa-rotate-270' :
                                            step.maneuver.modifier === 'slight right' ? 'fas fa-level-down fa-rotate-270' :
                                                'fas fa-random';
                        break;
                    case 'use lane':
                        iconClass = 'fas fa-road';
                        break;
                    default:
                        iconClass = 'fa-solid fa-arrow-up-long';
                        break;
                }
                const capitalizedDirection = direction.charAt(0).toUpperCase() + direction.slice(1);
                instructions += `
  <div class="instruction-step" style="color: #1E3050;">
    <i class="${iconClass}" style="padding-right: 10px;"></i>
    <div>
  <strong style="padding-left: 5px; padding-right: 2px;">${capitalizedDirection.replace(/new name/gi, 'go')}</strong>
  ${roadName ? `<span>&nbsp;onto&nbsp;${roadName}</span>` : ''}
  <span style="font-size: 0.8em;">&nbsp;${distance}</span>
  <!--<span>&nbsp;${duration} min</span>-->
</div>

  </div>
`;
                // Add a divider if it's not the last step
                if (index < steps.length - 1) {
                    instructions += '<hr style="border: 0.1px solid rgba(128, 128, 128, 0.3); margin: 5px 0;">';
                }
            });

            return instructions;
        }

        //Clear Input Boxes, Markers and Routes
        const gpsBtn = document.getElementById('gps');
        const clearOriginBtn = document.getElementById('clearOrigin');
        const originInput = document.getElementById('origin');
        const clearDestinationBtn = document.getElementById('clearDestination');
        const destinationInput = document.getElementById('destination');
        //const routeButton = document.getElementById('routeButton');
        const clearrouteButton = document.getElementById('clearrouteButton');

        function toggleButtons() {
            if (originInput.value.trim() === '') {
                gpsBtn.style.display = 'inline-block';
                clearOriginBtn.style.display = 'none';
            } else {
                gpsBtn.style.display = 'none';
                clearOriginBtn.style.display = 'inline-block';
            }
        }

        toggleButtons(); // Call the function on page load to set initial button display
        clearrouteButton.style.display = 'none'; // Hide clear route button on map load

        originInput.addEventListener('input', toggleButtons);

        gpsBtn.addEventListener('click', () => {
            // do something when GPS button is clicked
            originInput.value = 'Current location';
            toggleButtons();
        });

        clearOriginBtn.addEventListener('click', () => {
            originInput.value = '';
            toggleButtons();
        });

        routeButton.addEventListener('click', () => {
            // hide the route button and show the clear route button
            routeButton.style.display = 'none';
            clearrouteButton.style.display = 'inline-block';
            getRoute();
        });

        clearrouteButton.addEventListener('click', () => {
            // Remove origin and destination markers
            if (originMarker) {
                map.removeLayer(originMarker);
                originMarker = undefined;
            }
            if (destinationMarker) {
                map.removeLayer(destinationMarker);
                destinationMarker = undefined;
            }
            if (routeLayer) {
                map.removeLayer(routeLayer);
            }

            // Clear origin and destination input boxes
            originInput.value = '';
            destinationInput.value = '';

            // Show GPS button
            gpsBtn.style.display = 'inline-block';
            clearOriginBtn.style.display = 'none';
            clearDestinationBtn.style.display = 'none';

            // show the route button and hide the clear route button
            routeButton.style.display = 'inline-block';
            clearrouteButton.style.display = 'none';


            // Hide the distance, duration, and instructions divs
            document.getElementById('distance').style.display = 'none';
            document.getElementById('duration').style.display = 'none';
            document.getElementById('instructions').style.display = 'none';
        });


        // show or hide clear button based on input value
        destinationInput.addEventListener('input', () => {
            if (destinationInput.value.length > 0) {
                clearDestinationBtn.style.display = 'inline-block';
            } else {
                clearDestinationBtn.style.display = 'none';
            }
        });

        // clear input field when clear button is clicked
        clearDestinationBtn.addEventListener('click', () => {
            destinationInput.value = '';
            clearDestinationBtn.style.display = 'none';
        });

        // Clear markers
        if (originMarker) {
            map.removeLayer(originMarker);
            originMarker = undefined;
        }
        if (destinationMarker) {
            map.removeLayer(destinationMarker);
            destinationMarker = undefined;
        }


        routeButton.addEventListener('click', () => {
            // hide the route button and show the clear route button
            routeButton.style.display = 'none';
            clearrouteButton.style.display = 'inline-block';

            // Show the distance, duration, and instructions divs
            document.getElementById('distance').style.display = 'flex';
            document.getElementById('duration').style.display = 'flex';
            document.getElementById('instructions').style.display = 'block';

            getRoute();
        });


    </script>




    <script>


    </script>




</body>

</html>
